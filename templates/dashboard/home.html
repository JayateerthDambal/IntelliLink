{% extends 'base.html' %}
{% load static %}
{% block title %}
    CIS| Dashboard
{% endblock %}

{% block content %}
    <h3>Welcome to CIS--IntelliLink Platform, {{ request.user }}</h3>
    <div class="values">
        <div class="flex-container">
            <div class="val-box">
                <h4>Room Temperature</h4>
                <hr>
                <h3 id="roomTemp"><span></span></h3>
            </div>
            <div class="val-box">
                <h4>Room Humidity</h4>
                <hr>
                <h3 id="roomHumid"><span></span></h3>
            </div>

        </div>

        <div class="flex-container-2">
            <div class="val-box-2">
                <h4>Loom Temperature</h4>
                <hr>
                <h3 id="loomTemp"><span></span></h3>
            </div>
            <div class="val-box-2">
                <h4>Loom Humidity</h4>
                <hr>
                <h3 id="loomHumid"><span></span></h3>
            </div>

        </div>


    </div>
{#    <canvas id="paramsChart" data-url="{% url 'dash_getData' %}" style="width: border-box"></canvas>#}
    <div class="container">
    <div class="row align-items-start">
        <div class="col">
            <canvas id="paramsChart" data-url="{% url 'dash_getData' %}"></canvas>
        </div>
        <div class="col">
            <canvas id="paramsChart" data-url="{% url 'dash_getData' %}"></canvas>
        </div>
        <div class="col">
            <canvas id="paramsChart" data-url="{% url 'dash_getData' %}"></canvas>
        </div>
    </div>
    <script src="{% static 'js/jquery.js' %}"></script>
    <script>

        $(document).ready(function () {

            setInterval(function () {
                var $paramsChart = $("#paramsChart");
                $.ajax({
                    type: 'GET',
                    url: $paramsChart.data("url"),
                    success: function (response) {
                        {#console.log(response)#}
                        {#console.log(response.chart_data[0])#}

                        let roomTemp = response.senseVals['roomTemp']
                        let loomTemp = response.senseVals['loomtemp']
                        let roomHumid = response.senseVals['roomHumid']
                        let loomHumid = response.senseVals['loomHumid']
                        document.getElementById('roomTemp').textContent = roomTemp
                        document.getElementById('loomTemp').textContent = loomTemp
                        document.getElementById('roomHumid').textContent = roomHumid
                        document.getElementById('loomHumid').textContent = loomHumid
                        var paramsVals = []
                        var timeVals = []

                        for (let i = 0; i <= 19; i++) {
                            paramsVals.push(response.chart_data[i].roomTemp)
                            timeVals.push(response.chart_data[i].time)
                        }
                        console.log(paramsVals)

                        //Chart Data


                        {#var ctx = $paramsChart[0].getContext("2d");#}
                        var ctx = document.getElementById("paramsChart").getContext("2d");
                        let chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: timeVals,
                                datasets: [{
                                    label: 'Room Temperature',
                                    backgroundColor: 'rgb(38,55,201)',
                                    borderColor: 'rgb(103,124,201)',
                                    data: paramsVals
                                }]
                            },
                            options: {
                                responsive: true,
                                title: {
                                    display: true,
                                    text: 'Histrotic Trend Graph(Newest 10Values)'
                                },
                                animation:{
                                  tension:{
                                      duration:2000,
                                      easing: 'linear',
                                      delay: 100,
                                      loop: true
                                  }
                                }

                            }
                        })
                        chart.update();
                    },

                    error: function () {
                        alert('No Data Found')
                    }
                })


            }, 10000);


        });
    </script>
{% endblock %}
